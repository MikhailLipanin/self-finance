# Self Finance

CLI-приложение для управления личными финансами.
Позволяет отслеживать доходы, расходы, устанавливать бюджеты по категориям и получать сводную информацию о финансовом состоянии.

## Содержание

- [Реализованный функционал](#реализованный-функционал)
- [Требования](#требования)
- [Установка](#установка)
- [Использование](#использование)
- [Архитектура](#архитектура)
- [Структура проекта](#структура-проекта)
- [Формат данных](#формат-данных)
- [Примеры работы](#примеры-работы)
- [Команды Makefile](#команды-makefile)

## Реализованный функционал

- Авторизация пользователей: регистрация и вход по логину/паролю
- Добавление доходов по категориям
- Добавление расходов по категориям
- Установка лимитов бюджета для категорий расходов
- Просмотр информации о доходах, расходах и бюджетах
- Оповещения: уведомления о превышении лимитов бюджета и расходов над доходами
- Экспорт данных: сохранение в файл
- Сохранение данных в файл-хранилище; при запуске приложения загрузка данных из файла-хранилища

## Требования

- Java версия 17 или выше, Maven версия 3.6 или выше

Проверка версий:
```bash
java -version
mvn -version
```

## Установка

1. Склонируйте репозиторий:
```bash
git clone <repository-url>
cd self-finance
```

2. Установите зависимости:
```bash
make install
# или
mvn clean install
```

3. Скомпилируйте проект:
```bash
make compile
# или
mvn clean compile
```

## Использование

### Запуск приложения

Через Makefile:
```bash
make run
```

Через Maven:
```bash
mvn exec:java -Dexec.mainClass="com.selffinance.Main"
```

Через JAR файл:
```bash
make package
make run-jar
# или
java -jar target/self-finance-1.0-SNAPSHOT.jar
```

### Работа с приложением

#### 1. Авторизация

При первом запуске необходимо зарегистрироваться:
```
1. Вход
2. Регистрация
Выберите действие: 2
Введите имя пользователя: user1
Введите пароль: password123
```

#### 2. Добавление доходов

В главном меню выберите команду `1`:
```
Выберите команду: 1
Введите доходы в формате 'категория:сумма' (пустая строка для завершения):
Зарплата:20000
Зарплата:40000
Бонус:3000
[Enter - пустая строка для завершения]
```

#### 3. Добавление расходов

В главном меню выберите команду `2`:
```
Выберите команду: 2
Введите расходы в формате 'категория:сумма' (пустая строка для завершения):
Еда:300
Еда:500
Развлечения:3000
Коммунальные услуги:3000
Такси:1500
[Enter - пустая строка для завершения]
```

#### 4. Установка бюджета

В главном меню выберите команду `3`:
```
Выберите команду: 3
Введите бюджеты в формате 'категория:сумма' (пустая строка для завершения):
Еда:4000
Развлечения:3000
Коммунальные услуги:2500
[Enter - пустая строка для завершения]
```

#### 5. Просмотр сводки

В главном меню выберите команду `4`:
```
Выберите команду: 4
Общий доход: 63,000.0

Доходы по категориям:
  - Зарплата: 60,000.0
  - Бонус: 3,000.0

Общие расходы: 8,300.0

Бюджет по категориям:
  - Коммунальные услуги: 2,500.0, Оставшийся бюджет: -500.0
  - Еда: 4,000.0, Оставшийся бюджет: 3,200.0
  - Развлечения: 3,000.0, Оставшийся бюджет: 0.0
```

#### 6. Сохранение в файл

В главном меню выберите команду `5`:
```
Выберите команду: 5
Введите имя файла для сохранения: report.txt
Данные сохранены в файл: report.txt
```

#### 7. Выход

- Команда `6` - выход из текущего аккаунта
- Команда `7` - выход из приложения (данные автоматически сохраняются)

### Оповещения

Приложение автоматически уведомляет о превышении лимита бюджета по категории:
```
Внимание! Превышен лимит бюджета по категории 'Коммунальные услуги' на 500.00
```

И о превышении расходов над доходами:
```
Внимание! Расходы (8500.00) превышают доходы (6000.00) на 2500.00
```

## Архитектура

Приложение построено на принципах чистой архитектуры и разделено на следующие слои:

### 1. Доменный слой (с моделями)

Содержит бизнес-логику и сущности:
- `User` - пользователь системы
- `Wallet` - кошелёк пользователя с операциями
- `Operation` - операция (доход/расход/бюджет)
- `OperationType` - тип операции (INCOME, EXPENSE, BUDGET)

### 2. Слой репозитория

Интерфейсы и реализации для работы с данными:
- `UserRepository` - интерфейс для работы с пользователями
- `JsonUserRepository` - реализация с использованием JSON-файла

### 3. Сервисный слой

Бизнес-логика приложения:
- `AuthService` - авторизация и регистрация пользователей
- `FinanceService` - управление финансами (доходы, расходы, бюджеты)
- `PasswordEncoder` - кодирование паролей в hex

### 4. Слой представления

Пользовательский интерфейс:
- `CLI` - основной интерфейс командной строки
- `InputValidator` - валидация пользовательского ввода
- `OutputFormatter` - форматирование вывода данных


## Структура проекта

```
self-finance/
├── pom.xml                          
├── Makefile                         
├── README.md                        
├── data.json  // Генерируется приложением                      
├── .gitignore                       
└── src/
    └── main/
        └── java/
            └── com/
                └── selffinance/
                    ├── Main.java                    
                    ├── domain/                      
                    │   ├── User.java
                    │   ├── Wallet.java
                    │   ├── Operation.java
                    │   └── OperationType.java
                    ├── repository/                  
                    │   ├── UserRepository.java
                    │   └── JsonUserRepository.java
                    ├── service/                     
                    │   ├── AuthService.java
                    │   ├── FinanceService.java
                    │   └── PasswordEncoder.java
                    └── cli/                         
                        ├── CLI.java
                        ├── InputValidator.java
                        └── OutputFormatter.java
```

## Формат данных

Данные хранятся в файле `data.json` в следующем формате:

```json
{
  "userName": {
    "password": "<password_encoded_in_hex>",
    "opHistory": {
      "+Зарплата": 20000,
      "+Зарплата": 40000,
      "+Бонус": 3000,
      "-Еда": 300,
      "-Еда": 500,
      "-Развлечения": 3000,
      "-Коммунальные услуги": 3000,
      "-Такси": 1500,
      "!Еда": 4000,
      "!Развлечения": 3000,
      "!Коммунальные услуги": 2500
    }
  }
}
```

Для каждого пользователя сохраняется вся история его операций.
У каждой операции есть префикс, по которому приложение разделяет операцию по типу.

Префиксы операций:
- `+` - доходы
- `-` - расходы
- `!` - установка/изменение бюджета

Здесь пароли просто кодируются в 16-ричном виде без использования соли.
Сделано это целенаправленно, т.к. проект учебный.

## Примеры работы

### Пример 1: Полный цикл работы

```
Система управления личными финансами

1. Вход
2. Регистрация
Выберите действие: 2
Введите имя пользователя: alice
Введите пароль: secret123
Регистрация успешна!

Главное меню
Пользователь: alice
1. Добавить доходы
2. Добавить расходы
3. Установить бюджет
4. Показать сводку
5. Сохранить в файл
6. Выйти из аккаунта
7. Выход из приложения
Выберите команду: 1

Введите доходы в формате 'категория:сумма' (пустая строка для завершения):
Зарплата:50000
Бонус:5000

Доходы добавлены.

Выберите команду: 2
Введите расходы в формате 'категория:сумма' (пустая строка для завершения):
Еда:2000
Транспорт:1500
Развлечения:3000

Доходы добавлены.

Выберите команду: 3
Введите бюджеты в формате 'категория:сумма' (пустая строка для завершения):
Еда:3000
Развлечения:2500

Бюджеты установлены.

Выберите команду: 2
Введите расходы в формате 'категория:сумма' (пустая строка для завершения):
Еда:1500

Внимание! Превышен лимит бюджета по категории 'Еда' на 500.00

Расходы добавлены.

Выберите команду: 4
Общий доход: 55,000.0

Доходы по категориям:
  - Зарплата: 50,000.0
  - Бонус: 5,000.0

Общие расходы: 8,000.0

Бюджет по категориям:
  - Еда: 3,000.0, Оставшийся бюджет: -500.0
  - Развлечения: 2,500.0, Оставшийся бюджет: -500.0

Выберите команду: 7
Данные сохранены. До свидания!
```

## Команды Makefile

Проект включает Makefile для упрощения работы с Maven:

| Команда | Описание |
|---------|----------|
| `make help` | Показать справку по всем командам |
| `make compile` | Скомпилировать проект |
| `make clean` | Очистить проект (удалить target/) |
| `make run` | Запустить приложение (через exec:java) |
| `make run-jar` | Запустить приложение из JAR файла |
| `make package` | Создать JAR файл |
| `make install` | Установить зависимости |
| `make validate` | Валидировать pom.xml |
| `make all` | Очистить, скомпилировать и создать JAR |
| `make info` | Показать информацию о проекте |
